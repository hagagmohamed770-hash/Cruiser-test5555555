# ุจููุฉ ุงููุธุงู - ูุธุงู ุฅุฏุงุฑุฉ ุงูุงุณุชุซูุงุฑ ุงูุนูุงุฑู

ูุฐุง ุงููุณุชูุฏ ููุถุญ ุงูุจููุฉ ุงูุชูููุฉ ููุธุงู ุฅุฏุงุฑุฉ ุงูุงุณุชุซูุงุฑ ุงูุนูุงุฑู.

## ๐ ุฌุฏูู ุงููุญุชููุงุช

- [ูุธุฑุฉ ุนุงูุฉ ุนูู ุงูุจููุฉ](#ูุธุฑุฉ-ุนุงูุฉ-ุนูู-ุงูุจููุฉ)
- [ุงูุทุจูุงุช](#ุงูุทุจูุงุช)
- [ูุงุนุฏุฉ ุงูุจูุงูุงุช](#ูุงุนุฏุฉ-ุงูุจูุงูุงุช)
- [API](#api)
- [ุงููุงุฌูุฉ ุงูุฃูุงููุฉ](#ุงููุงุฌูุฉ-ุงูุฃูุงููุฉ)
- [ุงูุฃูุงู](#ุงูุฃูุงู)
- [ุงููุดุฑ](#ุงููุดุฑ)
- [ุงูุชูุณุน](#ุงูุชูุณุน)

## ๐๏ธ ูุธุฑุฉ ุนุงูุฉ ุนูู ุงูุจููุฉ

### ุงูููุท ุงููุนูุงุฑู

ุงููุธุงู ูุชุจุน ููุท **Client-Server Architecture** ูุน **RESTful API**:

```
โโโโโโโโโโโโโโโโโโโ    HTTP/HTTPS    โโโโโโโโโโโโโโโโโโโ
โ                 โ โโโโโโโโโโโโโโโโบ โ                 โ
โ   Frontend      โ                  โ   Backend       โ
โ   (Browser)     โ                  โ   (Node.js)     โ
โ                 โ                  โ                 โ
โโโโโโโโโโโโโโโโโโโ                  โโโโโโโโโโโโโโโโโโโ
                                              โ
                                              โผ
                                     โโโโโโโโโโโโโโโโโโโ
                                     โ                 โ
                                     โ   SQLite DB     โ
                                     โ                 โ
                                     โโโโโโโโโโโโโโโโโโโ
```

### ุงูููููุงุช ุงูุฑุฆูุณูุฉ

1. **ุงููุงุฌูุฉ ุงูุฃูุงููุฉ**: HTML, CSS, JavaScript
2. **ุงูุฎุงุฏู**: Node.js + Express.js
3. **ูุงุนุฏุฉ ุงูุจูุงูุงุช**: SQLite
4. **ุงููุตุงุฏูุฉ**: JWT
5. **ุงูุฃูุงู**: Helmet, CORS, Rate Limiting

## ๐ฏ ุงูุทุจูุงุช

### ุทุจูุฉ ุงูุนุฑุถ (Presentation Layer)

#### ุงููุงุฌูุฉ ุงูุฃูุงููุฉ
```javascript
// ูููู ุงููุงุฌูุฉ ุงูุฃูุงููุฉ
public/
โโโ index.html          // ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ
โโโ style.css           // ุงูุชุตููู
โโโ app.js              // ุงูููุทู ุงูุฑุฆูุณู
โโโ assets/             // ุงููููุงุช ุงูุซุงุจุชุฉ
    โโโ images/
    โโโ fonts/
```

#### ุงูููุฒุงุช
- **Responsive Design**: ูุชูุงูู ูุน ุฌููุน ุงูุฃุฌูุฒุฉ
- **Dark/Light Theme**: ุฏุนู ุงููุถุน ุงูุฏุงูู ูุงููุงุชุญ
- **RTL Support**: ุฏุนู ุงููุบุฉ ุงูุนุฑุจูุฉ
- **HTMX Integration**: ุชูุงุนู ุณูุณ ุฏูู ุฅุนุงุฏุฉ ุชุญููู

### ุทุจูุฉ ุงูุชุทุจูู (Application Layer)

#### ุงูุฎุงุฏู
```javascript
// ูููู ุงูุฎุงุฏู
server.js              // ููุทุฉ ุงูุจุฏุงูุฉ
โโโ routes/            // ูุณุงุฑุงุช API
โ   โโโ auth.js        // ุงููุตุงุฏูุฉ
โ   โโโ customers.js   // ุงูุนููุงุก
โ   โโโ units.js       // ุงููุญุฏุงุช
โ   โโโ contracts.js   // ุงูุนููุฏ
โ   โโโ installments.js // ุงูุฃูุณุงุท
โ   โโโ partners.js    // ุงูุดุฑูุงุก
โ   โโโ brokers.js     // ุงูุณูุงุณุฑุฉ
โ   โโโ vouchers.js    // ุงูุฅูุตุงูุงุช
โ   โโโ treasury.js    // ุงูุฎุฒููุฉ
โ   โโโ reports.js     // ุงูุชูุงุฑูุฑ
โ   โโโ backup.js      // ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ
โ   โโโ audit.js       // ุณุฌู ุงูุชุบููุฑุงุช
โโโ database/          // ูุงุนุฏุฉ ุงูุจูุงูุงุช
โ   โโโ database.js    // ุฅุฏุงุฑุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช
โโโ utils/             // ุงูุฃุฏูุงุช ุงููุณุงุนุฏุฉ
    โโโ audit.js       // ุณุฌู ุงูุชุบููุฑุงุช
```

#### ุงูููุฒุงุช
- **RESTful API**: ูุงุฌูุฉ ุจุฑูุฌุฉ ุชุทุจููุงุช ููุงุณูุฉ
- **Middleware**: ูุนุงูุฌุฉ ุงูุทูุจุงุช
- **Error Handling**: ูุนุงูุฌุฉ ุดุงููุฉ ููุฃุฎุทุงุก
- **Validation**: ุงูุชุญูู ูู ุตุญุฉ ุงูุจูุงูุงุช

### ุทุจูุฉ ุงูุจูุงูุงุช (Data Layer)

#### ูุงุนุฏุฉ ุงูุจูุงูุงุช
```sql
-- ูููู ูุงุนุฏุฉ ุงูุจูุงูุงุช
customers          -- ุงูุนููุงุก
units              -- ุงููุญุฏุงุช ุงูุนูุงุฑูุฉ
contracts          -- ุงูุนููุฏ
installments       -- ุงูุฃูุณุงุท
partners           -- ุงูุดุฑูุงุก
brokers            -- ุงูุณูุงุณุฑุฉ
vouchers           -- ุงูุฅูุตุงูุงุช
safes              -- ุงูุฎุฒุงุฆู
transfers          -- ุงูุชุญูููุงุช
partner_debts      -- ุฏููู ุงูุดุฑูุงุก
broker_dues        -- ูุณุชุญูุงุช ุงูุณูุงุณุฑุฉ
audit_log          -- ุณุฌู ุงูุชุบููุฑุงุช
users              -- ุงููุณุชุฎุฏููู
settings           -- ุฅุนุฏุงุฏุงุช ุงููุธุงู
```

#### ุงูููุฒุงุช
- **ACID Compliance**: ุถูุงู ุณูุงูุฉ ุงูุจูุงูุงุช
- **Indexing**: ููุงุฑุณ ูุญุณูุฉ ููุฃุฏุงุก
- **Relationships**: ุนูุงูุงุช ูุงุถุญุฉ ุจูู ุงูุฌุฏุงูู
- **Backup System**: ูุธุงู ูุณุฎ ุงุญุชูุงุทูุฉ

## ๐๏ธ ูุงุนุฏุฉ ุงูุจูุงูุงุช

### ุชุตููู ูุงุนุฏุฉ ุงูุจูุงูุงุช

#### ูุฎุทุท ุงูุนูุงูุงุช

```mermaid
erDiagram
    CUSTOMERS ||--o{ CONTRACTS : has
    UNITS ||--o{ CONTRACTS : has
    CONTRACTS ||--o{ INSTALLMENTS : generates
    PARTNERS ||--o{ PARTNER_DEBTS : has
    BROKERS ||--o{ BROKER_DUES : has
    SAFES ||--o{ VOUCHERS : contains
    SAFES ||--o{ TRANSFERS : from/to
    USERS ||--o{ AUDIT_LOG : creates
```

#### ุงูุฌุฏุงูู ุงูุฑุฆูุณูุฉ

##### ุฌุฏูู ุงูุนููุงุก (customers)
```sql
CREATE TABLE customers (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name TEXT NOT NULL,
    phone TEXT,
    email TEXT,
    address TEXT,
    id_number TEXT,
    status TEXT DEFAULT 'active',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

##### ุฌุฏูู ุงููุญุฏุงุช (units)
```sql
CREATE TABLE units (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name TEXT NOT NULL,
    type TEXT NOT NULL,
    area REAL,
    price REAL NOT NULL,
    location TEXT,
    status TEXT DEFAULT 'available',
    description TEXT,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

##### ุฌุฏูู ุงูุนููุฏ (contracts)
```sql
CREATE TABLE contracts (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    customer_id INTEGER NOT NULL,
    unit_id INTEGER NOT NULL,
    type TEXT NOT NULL,
    total_amount REAL NOT NULL,
    down_payment REAL DEFAULT 0,
    installment_amount REAL,
    installment_count INTEGER DEFAULT 0,
    start_date DATE NOT NULL,
    end_date DATE,
    status TEXT DEFAULT 'active',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (customer_id) REFERENCES customers (id),
    FOREIGN KEY (unit_id) REFERENCES units (id)
);
```

### ุชุญุณูู ุงูุฃุฏุงุก

#### ุงูููุงุฑุณ
```sql
-- ููุงุฑุณ ุฃุณุงุณูุฉ
CREATE INDEX idx_customers_name ON customers(name);
CREATE INDEX idx_customers_status ON customers(status);
CREATE INDEX idx_units_type ON units(type);
CREATE INDEX idx_units_status ON units(status);
CREATE INDEX idx_contracts_customer_id ON contracts(customer_id);
CREATE INDEX idx_contracts_unit_id ON contracts(unit_id);
CREATE INDEX idx_installments_due_date ON installments(due_date);
```

#### ุงูุฅุนุฏุงุฏุงุช
```sql
-- ุฅุนุฏุงุฏุงุช ูุญุณูุฉ
PRAGMA journal_mode = WAL;
PRAGMA synchronous = NORMAL;
PRAGMA cache_size = 10000;
PRAGMA temp_store = MEMORY;
```

## ๐ API

### ุชุตููู API

#### RESTful Endpoints

```javascript
// ุงููุตุงุฏูุฉ
POST   /api/auth/login          // ุชุณุฌูู ุงูุฏุฎูู
GET    /api/auth/verify         // ุงูุชุญูู ูู ุงูุชููู
POST   /api/auth/change-password // ุชุบููุฑ ูููุฉ ุงููุฑูุฑ

// ุงูุนููุงุก
GET    /api/customers           // ูุงุฆูุฉ ุงูุนููุงุก
GET    /api/customers/:id       // ุนููู ูุญุฏุฏ
POST   /api/customers           // ุฅุถุงูุฉ ุนููู
PUT    /api/customers/:id       // ุชุญุฏูุซ ุนููู
DELETE /api/customers/:id       // ุญุฐู ุนููู
GET    /api/customers/stats     // ุฅุญุตุงุฆูุงุช ุงูุนููุงุก

// ุงููุญุฏุงุช
GET    /api/units               // ูุงุฆูุฉ ุงููุญุฏุงุช
GET    /api/units/:id           // ูุญุฏุฉ ูุญุฏุฏุฉ
POST   /api/units               // ุฅุถุงูุฉ ูุญุฏุฉ
PUT    /api/units/:id           // ุชุญุฏูุซ ูุญุฏุฉ
DELETE /api/units/:id           // ุญุฐู ูุญุฏุฉ
GET    /api/units/stats         // ุฅุญุตุงุฆูุงุช ุงููุญุฏุงุช

// ุงูุนููุฏ
GET    /api/contracts           // ูุงุฆูุฉ ุงูุนููุฏ
GET    /api/contracts/:id       // ุนูุฏ ูุญุฏุฏ
POST   /api/contracts           // ุฅุถุงูุฉ ุนูุฏ
PUT    /api/contracts/:id       // ุชุญุฏูุซ ุนูุฏ
DELETE /api/contracts/:id       // ุญุฐู ุนูุฏ

// ุงูุฃูุณุงุท
GET    /api/installments        // ูุงุฆูุฉ ุงูุฃูุณุงุท
POST   /api/installments/generate // ุฅูุดุงุก ุฃูุณุงุท
PUT    /api/installments/:id/pay // ุฏูุน ูุณุท

// ุงูุชูุงุฑูุฑ
GET    /api/reports/dashboard           // ููุญุฉ ุงูุชุญูู
GET    /api/reports/sales               // ุชูุฑูุฑ ุงููุจูุนุงุช
GET    /api/reports/rentals             // ุชูุฑูุฑ ุงูุฅูุฌุงุฑุงุช
GET    /api/reports/overdue-installments // ุงูุฃูุณุงุท ุงููุชุฃุฎุฑุฉ
GET    /api/reports/partners            // ุชูุฑูุฑ ุงูุดุฑูุงุก
```

#### ุงุณุชุฌุงุจุฉ API

```javascript
// ุงุณุชุฌุงุจุฉ ูุฌุงุญ
{
  "success": true,
  "data": {
    // ุงูุจูุงูุงุช ุงููุทููุจุฉ
  },
  "message": "ุชูุช ุงูุนูููุฉ ุจูุฌุงุญ"
}

// ุงุณุชุฌุงุจุฉ ุฎุทุฃ
{
  "success": false,
  "error": "ERROR_CODE",
  "message": "ุฑุณุงูุฉ ุงูุฎุทุฃ",
  "details": {
    // ุชูุงุตูู ุฅุถุงููุฉ
  }
}
```

### ูุนุงูุฌุฉ ุงูุทูุจุงุช

#### Middleware Stack

```javascript
// ุชุฑุชูุจ Middleware
app.use(helmet());                    // ุงูุฃูุงู
app.use(cors());                      // CORS
app.use(compression());               // ุถุบุท ุงูุจูุงูุงุช
app.use(express.json());              // ุชุญููู JSON
app.use(express.urlencoded());        // ุชุญููู ุงูุจูุงูุงุช
app.use(rateLimit());                 // ุชุญุฏูุฏ ูุนุฏู ุงูุทูุจุงุช
app.use(express.static('public'));    // ุงููููุงุช ุงูุซุงุจุชุฉ

// ูุณุงุฑุงุช API
app.use('/api/auth', authRoutes);
app.use('/api/customers', customerRoutes);
app.use('/api/units', unitRoutes);
// ... ุจุงูู ุงููุณุงุฑุงุช
```

#### ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก

```javascript
// ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ุงูุนุงูุฉ
app.use((err, req, res, next) => {
  console.error(err.stack);
  
  res.status(err.status || 500).json({
    success: false,
    error: err.code || 'INTERNAL_ERROR',
    message: err.message || 'ุฎุทุฃ ุฏุงุฎูู ูู ุงูุฎุงุฏู',
    ...(process.env.NODE_ENV === 'development' && { stack: err.stack })
  });
});

// ูุนุงูุฌุฉ ุงููุณุงุฑุงุช ุบูุฑ ุงูููุฌูุฏุฉ
app.use('*', (req, res) => {
  res.status(404).json({
    success: false,
    error: 'NOT_FOUND',
    message: 'ุงููุณุงุฑ ุบูุฑ ููุฌูุฏ'
  });
});
```

## ๐จ ุงููุงุฌูุฉ ุงูุฃูุงููุฉ

### ูููู ุงููุงุฌูุฉ

#### ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ
```html
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ูุธุงู ุฅุฏุงุฑุฉ ุงูุงุณุชุซูุงุฑ ุงูุนูุงุฑู</title>
  <link rel="stylesheet" href="/style.css">
</head>
<body>
  <!-- ุงูุดุฑูุท ุงูุฌุงูุจู -->
  <aside class="sidebar">
    <!-- ูุงุฆูุฉ ุงูุชููู -->
  </aside>
  
  <!-- ุงููุญุชูู ุงูุฑุฆูุณู -->
  <main class="main-content">
    <!-- ุงูุดุฑูุท ุงูุนููู -->
    <header class="top-bar">
      <!-- ูุนูููุงุช ุงููุณุชุฎุฏู ูุงูุฅุนุฏุงุฏุงุช -->
    </header>
    
    <!-- ููุทูุฉ ุงููุญุชูู -->
    <div class="content-area">
      <!-- ูุญุชูู ุงูุตูุญุฉ -->
    </div>
  </main>
  
  <!-- ุงูููุงูุฐ ุงูููุจุซูุฉ -->
  <div class="modals">
    <!-- ููุงูุฐ ุฅุถุงูุฉ/ุชุนุฏูู -->
  </div>
  
  <script src="/app.js"></script>
</body>
</html>
```

#### ุงูุชุตููู
```css
/* ูุชุบูุฑุงุช CSS */
:root {
  --primary-color: #2563eb;
  --secondary-color: #64748b;
  --success-color: #059669;
  --danger-color: #dc2626;
  --warning-color: #d97706;
  --info-color: #0891b2;
  
  --bg-primary: #ffffff;
  --bg-secondary: #f8fafc;
  --text-primary: #1e293b;
  --text-secondary: #64748b;
  
  --border-radius: 0.5rem;
  --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
  --transition: all 0.3s ease;
}

/* ุงููุถุน ุงูุฏุงูู */
[data-theme="dark"] {
  --bg-primary: #1e293b;
  --bg-secondary: #334155;
  --text-primary: #f1f5f9;
  --text-secondary: #cbd5e1;
}
```

### ุงูุชูุงุนู

#### ุฅุฏุงุฑุฉ ุงูุญุงูุฉ
```javascript
// ุฅุฏุงุฑุฉ ุญุงูุฉ ุงูุชุทุจูู
class AppState {
  constructor() {
    this.state = {
      user: null,
      theme: 'light',
      currentPage: 'dashboard',
      loading: false,
      notifications: []
    };
    this.listeners = [];
  }

  setState(newState) {
    this.state = { ...this.state, ...newState };
    this.notifyListeners();
  }

  subscribe(listener) {
    this.listeners.push(listener);
  }

  notifyListeners() {
    this.listeners.forEach(listener => listener(this.state));
  }
}

const appState = new AppState();
```

#### ุฅุฏุงุฑุฉ API
```javascript
// ุฅุฏุงุฑุฉ ุทูุจุงุช API
class ApiManager {
  constructor() {
    this.baseUrl = '/api';
    this.token = localStorage.getItem('token');
  }

  async request(endpoint, options = {}) {
    const url = `${this.baseUrl}${endpoint}`;
    const config = {
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${this.token}`,
        ...options.headers
      },
      ...options
    };

    try {
      const response = await fetch(url, config);
      const data = await response.json();

      if (!response.ok) {
        throw new Error(data.message || 'ุฎุทุฃ ูู ุงูุทูุจ');
      }

      return data;
    } catch (error) {
      console.error('API Error:', error);
      throw error;
    }
  }

  get(endpoint) {
    return this.request(endpoint);
  }

  post(endpoint, data) {
    return this.request(endpoint, {
      method: 'POST',
      body: JSON.stringify(data)
    });
  }

  put(endpoint, data) {
    return this.request(endpoint, {
      method: 'PUT',
      body: JSON.stringify(data)
    });
  }

  delete(endpoint) {
    return this.request(endpoint, {
      method: 'DELETE'
    });
  }
}

const api = new ApiManager();
```

## ๐ ุงูุฃูุงู

### ุทุจูุงุช ุงูุฃูุงู

#### 1. ุงููุตุงุฏูุฉ ูุงูุชูููุถ
```javascript
// JWT Authentication
const jwt = require('jsonwebtoken');

// ุฅูุดุงุก ุชููู
function generateToken(user) {
  return jwt.sign(
    { id: user.id, username: user.username, role: user.role },
    process.env.JWT_SECRET,
    { expiresIn: '24h' }
  );
}

// ุงูุชุญูู ูู ุงูุชููู
function verifyToken(token) {
  try {
    return jwt.verify(token, process.env.JWT_SECRET);
  } catch (error) {
    throw new Error('ุชููู ุบูุฑ ุตุงูุญ');
  }
}

// Middleware ูููุตุงุฏูุฉ
function authenticateToken(req, res, next) {
  const authHeader = req.headers['authorization'];
  const token = authHeader && authHeader.split(' ')[1];

  if (!token) {
    return res.status(401).json({
      success: false,
      error: 'NO_TOKEN',
      message: 'ุชููู ูุทููุจ'
    });
  }

  try {
    const user = verifyToken(token);
    req.user = user;
    next();
  } catch (error) {
    return res.status(403).json({
      success: false,
      error: 'INVALID_TOKEN',
      message: 'ุชููู ุบูุฑ ุตุงูุญ'
    });
  }
}
```

#### 2. ุญูุงูุฉ ุงูุจูุงูุงุช
```javascript
// ุชุดููุฑ ูููุงุช ุงููุฑูุฑ
const bcrypt = require('bcryptjs');

// ุชุดููุฑ ูููุฉ ุงููุฑูุฑ
async function hashPassword(password) {
  const saltRounds = 10;
  return await bcrypt.hash(password, saltRounds);
}

// ุงูุชุญูู ูู ูููุฉ ุงููุฑูุฑ
async function verifyPassword(password, hash) {
  return await bcrypt.compare(password, hash);
}

// ุชูุธูู ุงูุจูุงูุงุช
function sanitizeInput(input) {
  return input
    .replace(/[<>]/g, '')
    .trim();
}
```

#### 3. ุญูุงูุฉ ูู ุงููุฌูุงุช
```javascript
// Helmet.js ููุฃูุงู
app.use(helmet({
  contentSecurityPolicy: {
    directives: {
      defaultSrc: ["'self'"],
      styleSrc: ["'self'", "'unsafe-inline'"],
      scriptSrc: ["'self'"],
      imgSrc: ["'self'", "data:", "https:"],
    },
  },
  hsts: {
    maxAge: 31536000,
    includeSubDomains: true,
    preload: true
  }
}));

// CORS
app.use(cors({
  origin: process.env.ALLOWED_ORIGINS?.split(',') || ['http://localhost:3000'],
  credentials: true,
  methods: ['GET', 'POST', 'PUT', 'DELETE', 'OPTIONS'],
  allowedHeaders: ['Content-Type', 'Authorization']
}));

// Rate Limiting
const rateLimit = require('express-rate-limit');

const limiter = rateLimit({
  windowMs: 15 * 60 * 1000, // 15 ุฏูููุฉ
  max: 100, // ุญุฏ ุฃูุตู 100 ุทูุจ
  message: {
    success: false,
    error: 'RATE_LIMIT_EXCEEDED',
    message: 'ุชู ุชุฌุงูุฒ ุญุฏ ุงูุทูุจุงุช'
  }
});

app.use('/api/', limiter);
```

### ุณุฌู ุงูุชุบููุฑุงุช
```javascript
// ุณุฌู ุงูุชุบููุฑุงุช
async function logAudit(userId, action, details) {
  const query = `
    INSERT INTO audit_log (user_id, action, details, ip_address, user_agent)
    VALUES (?, ?, ?, ?, ?)
  `;
  
  await db.run(query, [
    userId,
    action,
    JSON.stringify(details),
    req.ip,
    req.get('User-Agent')
  ]);
}

// ุงุณุชุฎุฏุงู ุณุฌู ุงูุชุบููุฑุงุช
app.post('/api/customers', authenticateToken, async (req, res) => {
  try {
    // ุฅุถุงูุฉ ุงูุนููู
    const result = await addCustomer(req.body);
    
    // ุชุณุฌูู ุงูุนูููุฉ
    await logAudit(req.user.id, 'CREATE_CUSTOMER', {
      customerId: result.id,
      customerName: req.body.name
    });
    
    res.json({ success: true, data: result });
  } catch (error) {
    res.status(500).json({ success: false, message: error.message });
  }
});
```

## ๐ ุงููุดุฑ

### ุจูุฆุงุช ุงููุดุฑ

#### ุงูุชุทููุฑ
```bash
# ุจูุฆุฉ ุงูุชุทููุฑ
NODE_ENV=development
PORT=3000
JWT_SECRET=dev_secret_key
DB_PATH=./data/development.db
```

#### ุงูุฅูุชุงุฌ
```bash
# ุจูุฆุฉ ุงูุฅูุชุงุฌ
NODE_ENV=production
PORT=3000
JWT_SECRET=production_secret_key
DB_PATH=./data/production.db
BACKUP_AUTO=true
BACKUP_INTERVAL=24h
```

### Docker
```dockerfile
# Dockerfile
FROM node:18-alpine

WORKDIR /app

COPY package*.json ./
RUN npm ci --only=production

COPY . .

RUN mkdir -p data backups

EXPOSE 3000

CMD ["npm", "start"]
```

```yaml
# docker-compose.yml
version: '3.8'
services:
  real-estate-app:
    build: .
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
      - JWT_SECRET=${JWT_SECRET}
    volumes:
      - ./data:/app/data
      - ./backups:/app/backups
    restart: unless-stopped
```

### PM2
```javascript
// ecosystem.config.js
module.exports = {
  apps: [{
    name: 'real-estate-system',
    script: 'server.js',
    instances: 'max',
    exec_mode: 'cluster',
    env: {
      NODE_ENV: 'production',
      PORT: 3000
    },
    env_production: {
      NODE_ENV: 'production',
      PORT: 3000
    },
    max_memory_restart: '1G',
    error_file: './logs/err.log',
    out_file: './logs/out.log',
    log_file: './logs/combined.log',
    time: true
  }]
};
```

## ๐ ุงูุชูุณุน

### ุงุณุชุฑุงุชูุฌูุงุช ุงูุชูุณุน

#### ุงูุชูุณุน ุงูุฃููู (Horizontal Scaling)
```javascript
// Load Balancer
const cluster = require('cluster');
const numCPUs = require('os').cpus().length;

if (cluster.isMaster) {
  console.log(`Master ${process.pid} is running`);

  // ุฅูุดุงุก ุนูุงู
  for (let i = 0; i < numCPUs; i++) {
    cluster.fork();
  }

  cluster.on('exit', (worker, code, signal) => {
    console.log(`Worker ${worker.process.pid} died`);
    cluster.fork(); // ุฅุนุงุฏุฉ ุฅูุดุงุก ุงูุนุงูู
  });
} else {
  // ููุฏ ุงูุนุงูู
  require('./server.js');
  console.log(`Worker ${process.pid} started`);
}
```

#### ุงูุชูุณุน ุงูุนููุฏู (Vertical Scaling)
```javascript
// ุชุญุณูู ุงูุฃุฏุงุก
const v8 = require('v8');

// ุฒูุงุฏุฉ ุญุฏ ุงูุฐุงูุฑุฉ
v8.setFlagsFromString('--max-old-space-size=4096');

// ูุฑุงูุจุฉ ุงูุฃุฏุงุก
setInterval(() => {
  const stats = v8.getHeapStatistics();
  console.log('Memory usage:', {
    used: Math.round(stats.used_heap_size / 1024 / 1024) + 'MB',
    total: Math.round(stats.total_heap_size / 1024 / 1024) + 'MB'
  });
}, 60000);
```

### ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงูููุฒุนุฉ

#### ุฅุนุฏุงุฏ ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงูููุฒุนุฉ
```javascript
// ุฅุนุฏุงุฏ ูุงุนุฏุฉ ุจูุงูุงุช ูุฑุงุกุฉ ูููุตูุฉ
const readDb = new sqlite3.Database('./data/read.db');
const writeDb = new sqlite3.Database('./data/write.db');

// ุชูุฌูู ุงูุทูุจุงุช
function routeQuery(sql, params = []) {
  const isReadQuery = /^SELECT/i.test(sql.trim());
  const db = isReadQuery ? readDb : writeDb;
  
  return new Promise((resolve, reject) => {
    db.all(sql, params, (err, rows) => {
      if (err) reject(err);
      else resolve(rows);
    });
  });
}
```

### ุงูุชุฎุฒูู ุงููุคูุช

#### Redis Cache
```javascript
const redis = require('redis');
const client = redis.createClient();

// ุชุฎุฒูู ูุคูุช ููุจูุงูุงุช
async function getCachedData(key) {
  const cached = await client.get(key);
  if (cached) {
    return JSON.parse(cached);
  }
  return null;
}

async function setCachedData(key, data, ttl = 3600) {
  await client.setex(key, ttl, JSON.stringify(data));
}

// ุงุณุชุฎุฏุงู ุงูุชุฎุฒูู ุงููุคูุช
app.get('/api/customers', async (req, res) => {
  const cacheKey = `customers:${req.query.page || 1}`;
  
  // ูุญุงููุฉ ุงูุญุตูู ูู ุงูุชุฎุฒูู ุงููุคูุช
  let data = await getCachedData(cacheKey);
  
  if (!data) {
    // ุงูุญุตูู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
    data = await getCustomers(req.query);
    // ุญูุธ ูู ุงูุชุฎุฒูู ุงููุคูุช
    await setCachedData(cacheKey, data);
  }
  
  res.json({ success: true, data });
});
```

---

**ุขุฎุฑ ุชุญุฏูุซ**: 2025-01-27  
**ุงูุฅุตุฏุงุฑ**: 1.0.0